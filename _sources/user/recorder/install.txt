==================
Installation Guide
==================

--------
Overview
--------

Components
==========
The LE Recorder is a supplemental component for the Live Expert System. It provides the ability to capture content on a Studio machine and upload it to a storage server for offline reviewing and auditing.

LE Recorder makes use of four applications within the Live Expert System. Below is a description of each application’s responsibilities within the context of the Recorder feature:

LE Enterprise
-------------
* Provides access to all configuration values for the capture and storage of call recordings.
* Provides an interface to lookup call recordings based upon call attributes, download and view call recordings, mark call recordings to * be saved, and store notes associated with a call recording.

LE Studio
---------
* Captures a configurable area of the agent’s display(s):
  * All display or primary display recording
  * LE Studio application window recording
  * Video chat only
  * Audio only
* Moves the file to a configurable location upon completion of the recording to hand it off to the Recording Transfer Service.

Recording Transfer Service
--------------------------
* Receives call recordings from the LE Studio and uploads them to the LE Recorder Server.
* Uploads call recordings when the host machine is not under heavy load.
* Manages upload retries and failure logic when the LE Recorder Server is not available.

LE Recorder Server
------------------
* Validates and receives call recordings from the Recording Transfer Service.<br>Houses call recordings.
* Manages the storage volume by executing the desired storage policy for recorded files
* Exposes a URL by which each call recording can be downloaded.

Network Protocols and Ports Used
================================
The following diagram outlines the deployment of these applications, as well as the protocols and ports used to facilitate their communication.

-------------------------------------
LE Recorder Installation Instructions
-------------------------------------
Both the Enterprise and Studio applications have all required components bundled into their initial deployments, requiring only configuration changes to enable them. However, the Recording Transfer Service and LE Recorder Server are separate applications that must be installed independently.

Recording Transfer Service Installation
=======================================
The transfer service should be installed on the Studio machine as an administrative service. Upon request we will provide a Windows installer to deploy this service on any machines on which you wish to enable recording.

Once the service is installed, it will start automatically when the machine boots up and runs at all times in the background, waiting for call recordings to be delivered to it by the Studio.

Live Expert Recorder Server Installation
========================================
The Recorder Server has been developed as a Java WAR that can be deployed in a number of application servers. It was developed and tested against the Apache Tomcat 7.0 server and we recommend using this for production deployments.

To install this component, perform the following steps:

#. Download and install the latest Java JDK. 
#. Set the JAVA_HOME environment variable to the JDK base directory.
#. Download the latest Apache Tomcat Server from http://tomcat.apache.org/.<br>Select the Core Binary Distribution for the appropriate version of Windows on which you are deploying.
#. Unpack this deployment into a known location on the Recorder Server.
#. Set a CATALINA_HOME environment variable to the Tomcat installation directory.
#. Upon request, we will provide a recorder.war file, which can be deployed into the CATALINA_HOME\webapps\ directory.<br>If you are upgrading the Live Expert Recorder Server, remove any previous recorder.war to a different location as a backup, as well as any webapps\recorder\ directory that may have been previously created.
#. To create a service that will start and stop Tomcat execute the following command: “%CATALINA_HOME%\bin\service.bat install LERecorder”<br>This will create a service with an ID of LERecorder and a display name of “Apache Tomcat LERecorder”
#. To configure the Live Expert Recorder Server the following Windows Environment Variables will need to be created or updated (previously configured in ``CATALINA_HOME\webapps\recorder\WEB-INF\servlet-context.xml``)
#. With the recorder.war in the webapps\ directory, start Tomcat.
#. In addition to the required settings, there are a number of configuration values that can be set, which are described in the Live Expert Recorder Configuration Options section.
#. System administrators should be aware of the following:

* The logs for this application can be found at CATALINA_HOME\logs\lerecorder-stdout.*.log and CATALINA_HOME\logs\lerecorder-stderr.*.log where the ‘*’ is replaced by the date for the log file. 
* The hard drive utilization will need to be monitored to ensure that there is sufficient disk space to keep files for the full retention timeframe.
* By default Tomcat is deployed on port 8080. 
* This can be updated in the CATALINA_HOME\conf\server.xml file.
* If the server is being run on anything other than port 80, the port needs to be included in the Recorder Server hostname configurations in both the Enterprise and Recorder Server.
* Tomcat exposes a wealth of configuration options. System administrators are advised to configure Tomcat for its target environment.

Windows Environment Variables:

CLAIRVISTA_RECORDER_ACTIVEMQ_JMSID
  Includes the Recorder ID (e.g. “recorder/1”)
CLAIRVISTA_RECORDER_ACTIVEMQ_URL
  This is the URL and PORT for ActiveMQ (e.g. ”tcp://liveexpert.net:61616?wireFormat.maxInactivityDuration=0")
CLAIRVISTA_RECORDER_DESTINATION_DIR
  The root directory on the Recorder server for storing all recording files. (e.g. “C:\recordings\”)
CLAIRVISTA_RECORDER_ID
  The Recorder ID (e.g. “1”)
CLAIRVISTA_RECORDER_POST_URL
  This is the URL at which this instance of LERecorder can be reached (e.g. “http://liveexpert.net/liveexpert/leservlet/recorder")
CLAIRVISTA_RECORDER_TRANSIT_DIR
  This is the sub-directory in which recordings are processed (e.g. “inTransit”)
CLAIRVISTA_RECORDER_URL_PATH
  This is the URL at which this instance of LERecorder can be reached (e.g. “recorder.liveexpert.net:8080/recorder/download/")

Live Expert Recorder Configuration Options
==========================================
The following configuration options are exposed for this feature.

Enterprise Configurations
-------------------------
These values are exposed through the Enterprise’s HTML interface.

Company 
~~~~~~~
Recording Enabled: Allows for recording to be enabled/disabled on a company wide basis. This must be enabled in order for any recordings to be captured.

Studio Settings
~~~~~~~~~~~~~~~
Recorder Enabled: Allows for recordings to be enabled for a specific group of agents.
Recorder Server: Assigns a Recorder Server to which this group of Studios will upload their call recordings.
Bitrate: Sets a target recording bitrate, allowing you to manage the tradeoff between video quality and file size. (Default: 30,000)
Content to Capture: Defines the region of an agent’s screen that will be captured in the recording. This can be set to one of the following five values:
All Screens: All screens attached to the agents machine will be recorded.
Primary Screen: The primary screen, as defined by the operating system, will be recorded.
Studio Application: The Studio application window will be recorded.
Studio Video: The video components of the Studio application, both playback and remote video, will be recorded.
Audio Only: The audio for both the agent and customer will be recorded. No video will be captured.
LEStudio PC Transfer Directory: Specifies the directory on the Studio machine into which recording files should be placed when they are ready to be uploaded. (Default: C:/tmp)
Upload Failure Action: The action to be taken if a file is unable to be uploaded to the specified recorder server. This can be set to one of the following two values (Default: Delete):
Keep: The file will be copied to another directory on the Studio machine for safekeeping.
Delete: The file will be deleted from the Studio machine without any backup or recovery available.
LEStudio PC Failed Upload Directory: Specifies the directory on the Studio machine into which recordings that were unable to be uploaded should be stored. (Default: C:/tmp/keep)

Recorder Server
~~~~~~~~~~~~~~~
Hostname: The location of the Recorder Server. This will be used by the Enterprise and Transfer Service to communicate with this server.
Use SSL: Indicates whether or not the server supports SSL communication. If so, the Transfer service will use the HTTPS protocol to upload files.
Maximum Upload Retry Count: Sets the maximum number of upload attempts for the Transfer Service before it deems the file unable to be uploaded. (Default: 3)
Seconds to Wait Between Upload Retries: Sets the number of seconds that the Transfer Service will wait between each attempt to upload a given file to the recorder server. (Default: 30)

Recorder Server Configurations
------------------------------
Within the /WEB-INF/classes/ directory of the WAR file is a recorder.properties file, which allows for the following configuration values to be set:

Recorder Server Properties
~~~~~~~~~~~~~~~~~~~~~~~~~~
readBufferBytes: The size of the network input byte buffer used for file uploads. We do not recommend changing this value.
maxFailedPing: The number of failed Enterprise ping requests that will result in the Recorder Server entering a disconnected state. Pings are sent every 15 seconds. 
hoursKept: The number of hours that recordings should be kept before being cleaned up, unless it has been marked as saved.
Note: If the disk becomes nearly full and a cleanup is forced, this may result in files being deleted before this amount of time has elapsed.
percentCleanDisk: The maximum, as a percentage of free disk space, that is considered a healthy amount of disk space. When a cleanup is forced, it will delete files to reach this percentage of free disk space.
percentRemainingDisk: The threshold, as a percentage of free disk space, that will force a cleanup of files down to the percentCleanDisk.
destinationDir: The root directory on the Recorder server  for storing all recording files.  
Note: Use double backslashes “\\” for directory separators.
transitDir: A subdirectory of the destinationDir in which files will be buffered during the upload process.
jmsID: The hostname assigned to this Recorder Server. This is used in this server’s communication with the Enterprise, therefore this must match the hostname for a Recorder Server configured in the Enterprise.
urlPath: The URL prefix used to download call recording files. This should include the Recorder Server’s hostname, but not a protocol.

-----------------------------------
Security Features & Recommendations
-----------------------------------

LE Recorder server Access
=========================
At most, three types of users need access to the LE Recorder server:
* Managers who will be reviewing recorded sessions
* LE Studio PC administrator users
* Administrators

All other users should not have privileges to access the LE Recorder server.

LE Studio User Privileges
=========================
Live Expert agents should not have Administrator privileges on the LE Studio PC. The LE Recorder Transfer Service is a Windows 7 service that will have Administrator privileges.

Securing Files in Transit
=========================
Install an SSL Certificate on the LE Recorder Tomcat application server and ensure the “Use SSL” option is selected in the Enterprise configuration for the server.

Securing Files at Rest
======================

LE Studio
  All recording files are stored in a directory that is configured in the Studio Settings through the LE Enterprise. This directory can be hidden from users without Administrator privileges on the LE Studio PC.
LE Recorder Server
  Windows Server 2008 and 2012 include the BitLocker Drive Encryption feature, which protects the data stored on its volumes.

File Names
==========
The names of files stored on disk and their names when downloaded are different. This provides an additional level of obscurity on disk.

On disk:
  ``{CallTimestamp}.{SessionLogId}.{UUID}.{SessionLogInteractionListId}.wmv``
When downloaded:
  ``Session{SessionLogID}-Interaction{SessionLogInteractionListId}-{YYYYMMDD}.wmv``

-------------------
System Requirements
-------------------
LE Recorder Server
==================
Server Specifications:
Intel Xeon E5 Processor
8 GB RAM
Hard Drive dependent on utilization, bitrate, and retention policy
Gigabit Ethernet Drive
Deploy an LE Recorder Server at each call center.
Connecting the server to the call center’s local area network will significantly improve recording upload speeds by preventing the data from routing over the wide area network.

LE Studio
=========
PC Specifications:
Windows 7
Core i5, at least
2 GB RAM
10 GB Available Hard Disk Space

LE Recording Review
===================
Playback Codec:
Video and audio recordings are encoded in Microsoft media formats. To view or listen to LE Recorder files, Windows Media Player 11 is required. 
Further, the Microsoft Expression Encoder Screen Capture Codec needs to be installed. See http://www.microsoft.com/en-us/download/details.aspx?id=10732 for more information.

--------------------------
Frequently Asked Questions
--------------------------
What gets recorded when an agent drags another application on top of the Studio window?
  The portion of the other application that is within the recorded area will be captured. The display is recorded just like the agent sees it.
If the Studio application is being recorded, what happens when an agent has their video undocked?
  The area of the display being captured will include both the Studio window and video window. 
If the Studio application is being recorded, what happens when the agent drags the window across the display?
  While the agent is dragging the window, the original area of the display that was occupied by the Studio application will be recorded. When the agent drops the window, the recording will end. This is a known issues with the recording library we are using and we are working to correct it. If the studio window is dragged around the screen often, we recommend capturing the Primary Screen or All Screens.
If the Studio application is being recorded, what happens when the window is partially off the screen?
  Only the portion of the Studio application that is visible on the screen will be recorded. Any portion that is off the screen will not be visible and therefore is not recorded.
If a recording fails to be uploaded, is there any notification or evidence of this on the enterprise? 
  No. Currently only uploaded recordings are visible in the Enterprise. Neither failed nor deleted recordings are accessible.
If an agent closes the Studio application immediately after a call, will the recording still be uploaded to the Recorder Server? 
  Not in all cases. If the Studio application is closed before the recording is fully prepared for upload, it will be left on the Studio machine and never uploaded to the server.
